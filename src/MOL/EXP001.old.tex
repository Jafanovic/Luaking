%     Subgigahertzový transceiver
% notes:
%~~~~~~~~~
%-------------------------------------------------------------------------------------------------------------
% Setting path to image 
\graphicspath{{../src/MOL/img/}}
%-------------------------------------------------------------------------------------------------------------
% file EXP001.tex
%==================== Kapitola: Subgigahertzový transceiver ==================================================
\chapter{Sub-1GHz transciever s obvodem SPIRIT1}
\minitoc
\newpage
  \section{Zadání}
    Úkolem je postavit nízkopříkonový transceiver vhodný pro bezdrátový přenos dat na frekvenci 
    \SI{468}{\MHz} mezi řídicím systémem (embedded PC) a senzory na vzdálenost minimálně 2000 m 
    ve volném terénu.
  
  \section{Popis obvodu SPIRIT1}  
    Pro efektivní řešení úloh tohoto typu je na trhu k dispozici mnoho integrovaných obvodů pro bezdrátový 
    přenos relativně malého objemu dat (řádově desítek kilobytů za sekundu) na vzdálenost až 10 km ve volném 
    prostoru, což je umožněno díky použití subgigahertzového pásma a vysokou citlivostí přijímače (běžně 
    dosahuje -100 dBm). Společně s nízkým příkonem jsou tyto obvody vhodnými kandidáty pro komunikaci mezi 
    různými senzory a regulátory například v budovách, infrastruktuře a v neposlední řadě také pro průmyslové 
    monitorování a řízení využívající bateriové či solární napájení. Vzájemná komunikace jednotlivých 
    zařízení pak tvoří základ nového trendu tzv. Internetu věcí (IoT - Internet of Thing). 
    
    Příkladem takového obvodu je transceiver Spirit1 od STMicroelectronic, který byl pro tuto konstrukci 
    vybrán. Transceveiver je navržen pro provoz v bezlicenčním pásmu ISM\footnote{Pod pojmem bezlicenční 
    (volné) pásmo se rozumí pásmo kmitočtů, ve kterém je povolen radiový provoz bez licenčních poplatků 
    držitelům homologovaných zařízení, přičemž jejich počet není předem omezen. Tito provozovatelé pak mohou 
    sdílet při provozu celé vyčleněné pásmo, ovšem bez nároku na ochranu proti rušení.} (Industrial, 
    scientific and medical radio bands) na frekvencích 169, 315, 433, 868 a 915 MHz a navíc dovoluje 
    programově měnit frekvenci ve čtyřech pásmech 150-174 MHz, 300-348 MHz, 387-470 MHz, 779-956 MHz. 
    
    Jelikož přístroje v pásmu ISM spadají do kategorie SRD (Short Range Devices) tj. zařízení krátkého 
    dosahu, mají vysílače omezený výkon na 25 až 100 mW efektivního vyzářeného výkonu (ERP). Obvod Spirit1 v 
    tomto směru nabízí programové řízení výstupního výkonu do maximální hodnoty +16 dBm (40 mW). 
    
%   The SPIRIT1 is a very low-power RF transceiver, intended for RF wireless applications in the sub-1 GHz 
%   band. It is designed to operate both in the license-free ISM and SRD frequency bands at 169, 315, 433, 
%   868, and 915 MHz, but can also be programmed to operate at other additional frequencies in the 300-348 
%   MHz, 387-470 MHz, and 779-956 MHz bands. The air data rate is programmable from 1 to 500 kbps, and the 
%   SPIRIT1 can be used in systems with channel spacing of 12.5/25 kHz, complying with the EN 300 220 
%   standard. It uses a very small number of discrete external components and integrates a configurable 
%   baseband modem, which supports data management, modulation, and demodulation. The data management 
%   handles the data in the proprietary fully programmable packet format also allows the M-Bus standard 
%   compliance format (all performance classes). However, the SPIRIT1 can perform cyclic redundancy checks on 
%   the data as well as FEC encoding/decoding on the packets. The SPIRIT1 provides an optional automatic 
%   acknowledgement, retransmission, and timeout protocol engine in order to reduce overall system costs by 
%   handling all the high-speed link layer operations. Moreover, the SPIRIT1 supports an embedded CSMA/CA 
%   engine. An AES 128-bit encryption co-processor is available for secure data transfer. The SPIRIT1 fully 
%   supports antenna diversity with an integrated antenna switching control algorithm. The SPIRIT1 supports 
%   different modulation schemes: 2-FSK, GFSK, OOK, ASK, and MSK. Transmitted/received data bytes are 
%   buffered in two different three-level FIFOs (TX FIFO and RX FIFO), accessible via the SPI interface for 
%   host processing. 

  \section{PA Tx Matching}
    The PA circuitry in the Spirit1 RFIC is not a conventional power amplifier (e.g., Class A/B/C) but 
    instead is of a type known as a “switching power amplifier” or “switching power converter”. Use of a 
    switching-type amplifier makes it possible to obtain levels of efficiency not achievable with 
    conventional amplifiers. However, the matching procedure for a switching PA is quite different and may 
    not be immediately intuitive.
    
    The theory of operation of such amplifiers is discussed briefly in this document; for a deeper 
    theoretical understanding (including derivation of the design equations for Class-E amplifiers), the 
    following papers are recommended:
    \begin{itemize}
      \item Class E – A New Class of High-Efficiency Tuned Single-Ended Switching Power Amplifiers, N. 
      Sokal and Sokal, IEEE Journal of Solid State Circuits, Vol. SC-10, No. 3, June 1975.
      \item Idealized Operation of the Class-E Tuned Power Amplifier, F. Raab, IEEE Transactions on 
      Circuits and Systems, Vol. CAS-24, No. 12, December 1977.
    \end{itemize}
  
    \subsection{Theory of Operation of an Ideal Switching PA}
      At the very heart of a switching PA is just that — a switch. In the Si4438, the switch is provided by 
      an NMOS cascode transistor in an open-drain configuration, sized to handle the current required for 
      the specified output power.

      Figure 1 shows the typical matching circuitry necessary to extract RF power from a switching 
      amplifier when matched for Class-E operation. The value of the pull-up inductor LCHOKE is chosen to 
      be a very large impedance at the frequency of operation (and its nearest harmonics), while the 
      series-resonant output tank (L0-C0) is chosen to resonate at the frequency of  operation. The shunt 
      capacitance CSHUNT is required to store energy during the switching cycle. This shunt capacitance 
      also works with matching components LX and CX to tailor the time-domain shape of the output waveform. 
      It is important to understand that optimization of the efficiency of a switching-type amplifier 
      requires control of the time-domain shape of the output waveform.

      \begin{figure}[ht!]  % \ref{EXP001:fig_spirit01}
        \centering
        \includegraphics[width=1\linewidth]{spirit01_AN732.png}
        \caption{Basic Switching PA Circuit Topology}
        \label{EXP001:fig_spirit01}
      \end{figure}        

      It may not be immediately clear to the reader how a switch “amplifies” an RF signal. From a purely 
      technical standpoint, it does not. As long as the input control signal to the switch is sufficient in 
      amplitude to toggle the switch between its ON and OFF states, the output waveform remains the same. 
      The amount of output power delivered to the load resistance is therefore independent of the amplitude 
      of the input control signal (i.e., amplitude of the RF signal at the gate of the output MOS device). 
      In such a case, defining the “gain” or amplification factor of the PA no longer has meaning. It is 
      more accurate to refer to this circuit as a “power converter” rather than a “power amplifier.”
      
      In an ideal switching PA matched for Class-E operation, the level of output power is dependent 
      primarily upon three parameters: 1) the dc supply voltage, 2) the shunt output capacitance, and 3) 
      the operating frequency. The relationship between these parameters and the output power is shown in 
      Equation 1. (The derivation for design equations is not provided within this document; please refer 
      to the papers listed above for a deeper understanding of the operational theory.)        
      \begin{equation}\label{EXP001:eq_spirit01}
        P_o = \pi\omega_0C_{shunt}V_DD^2
      \end{equation}
      
      This equation is interesting in that the output power is not a function of the load impedance. As 
      will be shown later, it is necessary to present the correct value of load impedance to the device in 
      order to obtain Class-E operation. However, once this load impedance is provided, the output power is 
      adjusted either by increasing the supply voltage or by increasing the shunt capacitance CSHUNT at the 
      output of the switching device.
      
      Furthermore, it is theoretically possible to achieve 100\% efficiency in an ideal switching PA. This 
      is a significant difference from conventional PAs. It is easily shown that the theoretical maximum 
      efficiency of a Class-A PA is 50\%, 78.5\% for Class-B, and so on. However, it is possible to tailor 
      the output waveform in a switching PA such that the voltage across the switch is always zero during 
      any period of time that the switch is conducting current, and the current conducted by the switch is 
      always zero during any period of time that the voltage across the switch is non-zero. Thus the power 
      dissipated by the switching device itself is zero, and the efficiency approaches 100\% (in the 
      absence of any other losses in the circuit). This is illustrated in a 315 MHz example in Figure 
      \ref{EXP001:fig_spirit02}, where it is observed that non-zero values of the voltage and current 
      waveforms never occur at the same time.
      
      \begin{figure}[ht!]  % \ref{EXP001:fig_spirit02}
        \centering
        \includegraphics[width=1\linewidth]{spirit02_AN732.png}
        \caption{Theoretical Class-E Drain Voltage/Current Waveforms}
        \label{EXP001:fig_spirit02}
      \end{figure} 
      
      \subsubsection{Limitations of a Practical MOS Switching PA}
        There is no theoretical limit to the amount of power that may be extracted from an ideal switching 
        PA. In practice, several factors prevent achieving “ideal” operation. These factors include the 
        maximum operating voltage of the switch (i.e., MOS output device), the maximum current (limited by 
        the size of the MOS output device), ON and OFF state resistances of the MOS output device, non-zero 
        switching times of the MOS output device, and losses in the output matching components due to 
        finite Qs. All of these factors combine to limit the achievable output power and efficiency.
        
        The limitation on the maximum drain voltage of the MOS output device turns out to be a considerable 
        constraint. RF design engineers may be quite familiar with the waveforms obtained with 
        inductively-loaded conventional PAs, where the peak output voltage reaches a value equal to twice 
        the dc supply voltage. However, the peak of the output voltage waveform in a switching PA may far 
        exceed this “2xVDD” rule-of-thumb. As is shown in the papers listed above, the peak drain voltage 
        for a Class-E switching amplifier can reach 3.56 x VDD.

    \subsection{Overview of Class-E Matching Procedure}
      This application note discusses the Class-E matching procedure for the Spirit1 RFIC in great detail. 
      However, some readers may be interested in quickly gaining a high-level overview of the procedure 
      before getting into the fine details. For those readers, the main points of the Class-E matching 
      procedure are summarized below:
      
      \subsubsection{Split TX/RX Board Configuration}
        The following steps provide a broad overview of the matching methodology for Class-E operation on 
        the Split TX/RX board configuration. Further details of each step will be provided later.
        \begin{enumerate}
          \item Choose LCHOKE (pull-up inductor) for high impedance at Fo (and its nearest harmonics).
          \item Choose/calculate values for series-resonant tank L0-C0 such that L0-C0 resonates at Fo.
          \item Calculate required value of ZLOAD, given the desired frequency of operation (Fo) and the 
                shunt drain capacitance (CSHUNT = ~2.5 pF on the Si4438 RFIC around the 490 MHz band).
          \item Calculate required value for the voltage-limiting resistor RDC, given the desired output 
                power and VDD supply voltage. It has to be emphasized that in the tested circuits the 
                external voltage limiting resistor is not used. Instead, the on-state FET resistance is tuned 
                properly by setting the power state.
          \item Calculate values for matching components LX and CM, given the antenna load resistance 
                (e.g., RANT = 50 Ω) and the calculated value for ZLOAD.
          \item Design a low-pass filter to provide sufficient attenuation of harmonic signals.
          \item For RX Input Matching is next necessary to construct a 4-element RX match network to 
                simultaneously provide an impedance match as well as a single-ended to differential 
                conversion function (i.e., balun).
        \end{enumerate}

      \subsubsection{Direct Tie Board Configuration}
        The following steps provide a broad overview of the matching methodology for Class-E operation on 
        the Split TX/RX board configuration. Further details of each step will be provided later.
        \begin{enumerate}
          \item Repeat Steps 1 through 6, as shown immediately above.
          \item Construct a 4-element balun match to the differential RXp/RXn LNA input pins, using the 
                methodology outlined in chapter 4.
          \item Connect the TX and RX paths together, and deliberately mis-tune L0 by increasing its value 
                if required above its calculated optimum value.
        \end{enumerate}
    
    \subsection{Detailed Class-E Matching Procedure}
      In this section, further detail is provided about each step of the Class-E Split TX/RX matching 
      procedure outlined above. A supply voltage of VDD = 3.3 V and an operation frequency of 470 MHz is 
      assumed. The matching circuits given in chapter 3. Summary of Matching Network Component Values” are 
      designed to 490 MHz center frequency.
      
      \subsubsection{Step 1: Select a Value for LCHOKE Pull-Up Inductor}
        In the theoretical derivation for Class-E switching amplifiers, the desired impedance of the 
        pull-up inductor LCHOKE is zero at dc and infinite at all other frequencies. This is not achievable 
        in practice; however, a large value of inductance provides a reasonable approximation to this 
        performance. The value of LCHOKE should be chosen such that it provides a high impedance at not 
        only the fundamental operating frequency but also at the first few harmonic frequencies as well. 
        The inductance value should not be so large as to already be at (or past) parallel selfresonance at 
        the desired operating frequency.
        
        The exact inductance value is not critical; however, Silicon Laboratories recommends the following 
        range of inductance values (assuming 0402-size or 0603-size inductors) as a function of the desired 
        operating frequency:
        \begin{itemize}
          \item 315 MHz: approximately 390 nH
          \item 470 MHz: approximately 220 nH
          \item 915 MHz: approximately 100 nH
        \end{itemize}
        
      \subsubsection{Step 2: Choose/Calculate Values for L0-C0 Series-Resonant Tank}
        In Step 2, the L0-C0 tank is designed to be series-resonant at the desired operating frequency Fo. 
        It is self-evident that there are infinite combinations of L0-C0 values that can achieve resonance 
        at a desired frequency. However, certain broad guidelines may be used to select one particular 
        solution of component values.
        
        First, the inductance and capacitance values should be neither extremely large or extremely small. 
        Discrete inductors and capacitors with extremely large values are subject to degrading effects due 
        to self-resonance. Discrete components with extremely small values are also subject to degrading 
        effects due to component tolerance. In either case, the actual resonant frequency of the tank may 
        be significantly different than the frequency predicted by mathematical calculations.
        Second, in the theoretical derivation for Class-E switching amplifiers it is desired that the 
        impedance of the L0-C0 series-resonant tank be zero at Fo and infinite at all other frequencies. 
        This is not achievable in practice; however, a reasonable approximation to this performance may be 
        obtained by using values with a high L-to-C ratio.
        
        Third, it is desirable to minimize the insertion loss of the resonant tank. As the quality factor 
        (Q) of discrete inductors is generally much lower than that of discrete capacitors, it is important 
        to select an L0-C0 ratio that maximizes the inductor Q. The Q of discrete inductors generally 
        increases as the inductance value is also increased, until the inductance approaches the value 
        where self-resonance becomes a concern.
        
        Finally, it is desirable to select component values that are near standard 5\% tolerance values. 
        These considerations lead to the following guidelines for selecting the values for L0-C0:
        \begin{itemize}
          \item The L0-C0 tank must resonate at Fo
          \item The value of L0 should be chosen as large as possible,
          \item While remaining low enough that effects of self-resonance are not an issue,
          \item And are close to standard 5% tolerance values
        \end{itemize}
        
        Assuming a desired operating frequency of Fo = 470 MHz as an example, these guidelines lead to 
        selection and/or calculation of the following values for L0-C0:
        \begin{itemize}
          \item C0 = 8.2 pF (chosen)
          \item L0 = 13.903 nH (calculated)
        \end{itemize}
        
      \subsubsection{Step 3: Calculate the Required Value for ZLOAD}
        In Step 3, the required value of load impedance is calculated. This represents the impedance that 
        must be presented to the output of the L0-C0 resonant tank, and is calculated at the fundamental 
        operating frequency Fo.
        
        In the theoretical derivation for Class-E switching amplifiers, it is shown that the required load 
        impedance (ZLOAD) is a function of shunt drain capacitance (CSHUNT) and operating frequency 
        \(\omega_o = 2\pi f_o\) as follows:
        \begin{equation}\label{EXP001:eq_spirit02}
          Z_{LOAD_{fund}} = \left(\frac{0.2815}{\omega_oC_{shunt}}\right)e^{j49.0524°}
        \end{equation}
        
        This equation states that the required load impedance (ZLOAD) does not vary with the desired level 
        of output power, but depends only on the desired operating frequency and value of shunt drain 
        capacitance. The value of internal shunt drain capacitance CSHUNT is a design parameter of the 
        Si4438 RFIC and is not adjustable by the user. This shunt capacitance is composed primarily of the 
        drain-source capacitance (Cds) of the output MOS devices. Silicon Laboratories states that the 
        value of this internal shunt drain capacitance is approximately:          
        \begin{equation}\label{EXP001:eq_spirit03}
          C_{SHUNT} ~ \SI{2.5}{pF}
        \end{equation}          
        
        Assuming a desired operating frequency of Fo = 470 MHz as an example, the following value for ZLOAD 
        may be calculated:
        \begin{equation}\label{EXP001:eq_spirit04}
          Z_{LOAD(470\,MHz)} = 
            \left(\frac{0.2815}{2\pi\cdot\SI{470}{MHz}\cdot\SI{2.5}{pF}}\right)e^{j49.0524°} =
            24.87 + j28.66\Omega
        \end{equation} 
        
        This value of load impedance (ZLOAD) is not the same parameter as the antenna impedance (ZANT), nor 
        do they necessarily have the same ohmic value. A matching network must be constructed that 
        transforms the arbitrary value of antenna impedance ZANT into the required value of load impedance 
        ZLOAD, as seen at the output of the L0-C0 resonant circuit.
        \begin{equation}\label{EXP001:eq_spirit05}
          V_{DD_{PA}} = \sqrt{\frac{P_{out}}{\pi\omega_oC_{shunt}}}
        \end{equation}
        Continuing the design example of 470 MHz and assuming a desired output power of +20 dBm (100 mW), 
        the required value of VDD\_PA may be calculated:
        \begin{equation}\label{EXP001:eq_spirit06}
          V_{DD_{PA}} =\sqrt{\frac{\SI{0.1}{W}}{2\pi^2\SI{470}{MHz}\cdot\SI{2.5}{pF}}} = \SI{2.076}{V}
        \end{equation}
        This equation states that if the voltage supplied to the top of pull-up inductor LCHOKE is equal to 
        2.076 V and the previously-calculated value of load impedance ZLOAD is presented to the chip, the 
        resulting output power will be POUT = 100 mW = +20 dBm.
        
        This required PA supply voltage (VDD\_PA) is significantly different than the general supply 
        voltage (VDD) for the rest of the RFIC. It is obviously not desirable to maintain two separate, 
        independent sources of supply voltage for the RFIC; therefore, it is convenient to create the PA 
        output supply voltage from the main supply voltage by means of an I-R voltage drop across a 
        resistor or a properly adjusted internal switcher loss.
        
        As the theoretical efficiency of a Class-E switching amplifier is 100\%, the average PA drain 
        current IDD\_PA may be calculated as:
        \begin{equation}\label{EXP001:eq_spirit07}
          P_{OUT} = \pi\omega_0C_{SHUNT}V_{DD_{PA}}^2 = I_{DD_{PA}} \cdot V_{DD_{PA}}
        \end{equation}
        This equation may be solved for \(I_{DD_{PA}}\) to obtain:
        \begin{equation}\label{EXP001:eq_spirit08}
          I_{DD_{PA}} = \pi\omega_0C_{SHUNT}V_{DD_{PA}}^2 = I_{DD_{PA}} \cdot V_{DD_{PA}}
        \end{equation}
        Given the main supply voltage for the remainder of the chip (VDD), and having previously calculated 
        the required value of PA supply voltage (VDD\_PA) and average PA drain current (IDD\_PA), it is a 
        simple matter to calculate the required value for RDC:
        \begin{equation}\label{EXP001:eq_spirit09}
          R_{DC} = \frac{V_{DD} - V_{DD_{PA}}}{I_{DD_{PA}}}
        \end{equation} 
        Continuing the design example of 470 MHz for +20 dBm output power, the following calculations are 
        made:
        \begin{equation}\label{EXP001:eq_spirit10}
          I_{DD_{PA}} = 2\pi^2\cdot\SI{470}{MHz}\cdot\SI{2.5}{pF}\cdot\SI{2.076}{V} = \SI{48.16}{mA}
        \end{equation} 
        Assuming a general chip supply voltage of VDD = 3.3 V, the required value of RDC may be calculated 
        as:
        \begin{equation}\label{EXP001:eq_spirit11}
          R_{DC} = \frac{\SI{3.3}{V} - \SI{2.076}{V}}{\SI{48.16}{mA}}  = \SI{25.41}{\ohm}
        \end{equation} 
        
        Theoretically, this value of resistance must be placed in series with LCHOKE in order to drop the 
        general chip supply voltage down to the value required to obtain the desired output power.
        
        However, these calculations for the value of RDC assume theoretically-ideal Class-E operation. In 
        practice, the circuit will not behave exactly as predicted by these equations due to non-idealities 
        such as non-zero ON-state resistance, finite OFF-state resistance, non-zero switching times, and 
        loss in the external matching components. As a result, the output power obtained for a given value 
        of VDD supply voltage will almost certainly be slightly less than predicted by theory. Stated 
        another way, it will almost always be necessary to use a smaller value of RDC than predicted by 
        theory in order to obtain the desired value of output power. Some amount of post-calculation 
        “tweaking” of the component values is considered a normal part of the PA matching process, 
        especially if the tuning of the switcher’s ON-state resistance is used instead of an external RDC. 
        In this case, a tweaking of the power state is required at the applied supply voltage.
      
      \subsubsection{Step 5: Calculate the Values for Matching Components LX and CM}
        In Step 5, the values of the matching components (LX and CM) required to transform the given 
        antenna impedance (ZANT) into the required load impedance (ZLOAD) are calculated.
        
        This matching effort may be accomplished by simple and normal design methods, such as use of a 
        Smith Chart or impedance matching CAD software (e.g., WinSmith™). Continuing the design example for 
        470 MHz and assuming an antenna impedance of ZANT = RANT = 50 Ω, it is found that a shunt 
        capacitance CM = 6.81 pF and series inductance LX = 18.17 nH is required to transform RANT = 50 Ω 
        to the required value of ZLOAD = 24.87 + j 28.66 Ω. The resulting circuit topology is shown in 
        figure \ref{EXP001:fig_spirit01}.
        
        This is only one possible solution for the required impedance transformation; other matching 
        topologies could have been used as well. The reader should also note that the required LX-CM match 
        topology depends upon the real part of the load impedance, Re(ZLOAD). In this example, the real 
        part of the load impedance was less than 50 Ω and thus an appropriate matching topology consisted 
        of a shunt capacitor (CM) and a series inductor (LX). In the event that Re(ZLOAD) had been greater 
        than 50 Ω, an appropriate matching topology would have consisted of first a series inductor (LX) 
        followed by a shunt capacitor (CM).
        
        It is apparent that series inductors L0 and LX may be combined into one equivalent inductor with a 
        value equal to the sum of their individual inductances, in order to reduce parts count. This is a 
        normal and usual practice.
        
        In the example shown here, the following component values (obtained through use of the above design 
        equations) were obtained:
        
        \begin{itemize}
          \item Fo = 470 MHz
          \item POUT(TARGET) = +20 dBm
          \item VDD = 3.3 V
          \item CSHUNT = 2.5 pF
          \item LCHOKE = 220 nH
          \item RDC = 25.41 Ω
          \item C0 = 6.81 pF
          \item L0+LX = 32.15 nH
          \item CM = 6.81 pF          
        \end{itemize}
        
        In practice, these exact values would be rounded to the nearest available 5\% tolerance parts 
        (e.g., L0+LX = 30 nH, CM = 6.8 pF, RDC=24 ohms). Also, as mentioned previously, the external RDC 
        resistor is not used in the Si4428 matching. Instead the internal switcher on-state resistance is 
        adjusted properly by the power setting (PDAC register value).
        
      \subsubsection{Step 6: Design a Lowpass Filter}
        In Step 6, a low-pass filter network is designed in order to attenuate the harmonics below the 
        level required to meet applicable regulatory standards (e.g., FCC or ETSI).
        
        The signal at the output of the match shown in Figure 5 will likely contain relatively high levels 
        of harmonics. Although the bandpass response of the series-resonant L0-C0 tank provides some 
        attenuation of harmonic signals, it is generally not sufficient to meet applicable regulatory 
        standards. This is normal for such a switching-amplifier and matching topology.
        
        It is difficult for Silicon Laboratories to recommend one single low-pass filter design that is 
        appropriate for all customers, as customers may operate under widely differing regulatory standards 
        and harmonic requirements. Also, the radiation efficiency of the antenna selected by the customer 
        is not known in advance. These factors make it difficult for Silicon Laboratories to conclusively 
        state the required filter attenuation characteristics. As a reasonable compromise, the following 
        design goals for the low-pass filter are chosen:
        \begin{itemize}
          \item Minimal insertion loss at the desired operating frequency
          \item Lowest filter order possible to achieve harmonic attenuation required to meet regulatory 
                standard
          \item impedance transformation (i.e. \SI{50}{\ohm} input and \SI{50}{\ohm} output 
                impedance)          
        \end{itemize}
        
        Note that the amplitude characteristics of the LPF in the lower portion of the passband are 
        relatively unimportant. Because the output signal contains no frequency components below the 
        fundamental frequency, the frequency response of the filter below the desired operating frequency 
        is of little consequence. It is therefore acceptable to select the filter type (e.g., Butterworth, 
        Chebyshev, Elliptic) based primarily upon the filter’s attenuation characteristics rather than its 
        passband response.
        
        A Butterworth filter design is sub-optimal because it provides relatively poor high-frequency 
        attenuation characteristics; there is no need to sacrifice high-frequency attenuation in order to 
        obtain a maximally-flat in-band frequency response.
        
        Similarly, an Elliptic filter design (Cauer-Chebyshev) may provide insufficient attenuation at 
        higher-order harmonic frequencies. While it may be possible (and advantageous) to tune a 
        transmission zero in the stopband to the exact frequency of a problematic harmonic (e.g., N=2 or 
        N=3), it is paid for with a decrease in attenuation at higher harmonic frequencies. Insufficient 
        attenuation of higher-order harmonics may result.
        
        As a result, a Chebyshev low-pass filter design is settled upon as an acceptable type of filter 
        response. With a Chebyshev filter, it is possible to obtain a greater rate of attenuation roll-off 
        in the stopband by accepting a larger amount of amplitude ripple in the passband. However, this 
        design trade-off should not be pushed too far. By designing for a limited amount of passband 
        amplitude ripple, an upper limit is placed on the filter insertion loss due to mistuning of the 
        component values and thus accidentally operating on a minimum of the amplitude ripple response 
        rather than on a maximum. Silicon Laboratories recommends a Chebyshev passband amplitude ripple of 
        0.25 dB to 0.5 dB as providing a reasonable balance between high-frequency stopband attenuation and 
        potential passband filter insertion loss due to component tolerance.
       
        \begin{figure}[ht!]  % \ref{EXP001:fig_spirit03}
          \centering
          \includegraphics[width=1\linewidth]{spirit03_AN732.png}
          \caption{ Ideal \(3^{rd}\)-Order 0.5 dB Chebyshev Filter Response at 470 MHz}
          \label{EXP001:fig_spirit03}
        \end{figure} 
        
        Figure \ref{EXP001:fig_spirit03} shows the passband frequency response of an ideal (lossless) 
        Chebyshev filter with 0.5 dB of amplitude ripple in the passband. In order to minimize the 
        insertion loss of the filter at the desired operating frequency, it is necessary to design the 
        cutoff frequency of the filter such that the desired operating frequency falls at one of the 
        passband amplitude ripple peaks (Cursor “A” in the plot). If the desired operating frequency fell 
        on a minimum of the amplitude ripple response (rather than on a maximum), the filter insertion loss 
        would increase and the TX output power would decrease.
        
        Filter component values may be obtained by usual design methods, such as use of Filter Design CAD 
        software or tables of normalized filter values scaled to the desired frequency of operation. Note 
        that Silicon Laboratories recommends designing the filter such that the desired operating frequency 
        falls at a peak of the amplitude ripple response rather than at the 3 dB cutoff frequency or at the 
        equal amplitude ripple cutoff frequency. In this manner, the insertion loss of the filter will be 
        minimized, and the TX output power will be maximized. For a 3rd-order 0.1 dB
        
        Chebyshev filter, the ratio of F3dB:FPEAK is approximately 1.60:1. That is, if the desired 
        operating frequency is 470 MHz, the filter must be designed for a 3 dB cutoff frequency of 470 x 
        1.60 = 752 MHz. For a 3rd-order 0.5 dB
        
        Chebyshev filter, the ratio of F3dB:FPEAK is approximately 1.346:1. SPICE model simulations of 
        non-ideal discrete components predict an in-band filter insertion loss of approximately 1.0 dB at 
        the desired operating frequency (470 MHz, in this example). While not desirable, this value of 
        filter insertion loss is fairly realistic, given the typical Qs of discrete components in 0402-size 
        or 0603-size surfacemount packages. Discrete components of higher quality (e.g. wire-wound 
        inductors) may be chosen in an effort to reduce insertion loss, but such parts are admittedly more 
        expensive. The Si4438 RFIC is capable of providing the specified output power (+20 dBm) at the 
        antenna output connector (i.e., after the insertion loss of the match and lowpass filter)
        
      \subsubsection{Step 7: Design RX Input Match}
        The mathematical derivation for the required component values has been thoroughly described in 
        “AN643: Si446x RX LNA Matching”; the relevant equations from that document are shown here.
   
  \section{RX LNA Matching}
    AN643 Si446x RX LNA Matching”
  
    The LNA on the Si446x/Si4362 family of chips is designed as a differential amplifier and thus has two 
    input pins (RXp and RXn) on the RFIC. It is necessary to design a network that not only provides a 
    conjugate match to the input impedance of the LNA but also provides a balanced-to-unbalanced conversion 
    function (i.e., a balun).
    
    The LNA design is differential and thus the RXp and the RXn input pins may be considered interchangeable. 
    Although the figures in this document may show the matching components connected to the RXp/RXn pins in a 
    certain fashion, the pin connections may be reversed without change in functionality.
    
    Use of two basic matching network topologies will be considered within this application note.
    \begin{itemize}
      \item Three-Element Match Network
      \item Four-Element Match Network
    \end{itemize}
    
    \subsection{Three-Element Match Network}
      The simplest match network that may be fabricated from discrete components is comprised of three 
      discrete elements. Two forms of the 3-element match network may be constructed: one with a highpass 
      filter (HPF) response, and one with a lowpass filter (LPF) response. However, the form with a lowpass 
      filter response is not realizable at all frequencies and input impedances. As a result, only the form 
      with a highpass filter response is discussed within this document.
      
      A 3-element (CR1-LR1-CR2) HPF matching network is shown in Figure \ref{EXP001:fig_spirit07}. This 
      matching network has the virtue of requiring a minimum number of components but results in slightly 
      sub-optimal performance. It is not theoretically possible to achieve a perfectly balanced 
      single-ended-to-differential conversion function with this matching network for input impedances with 
      finite values of RLNA. As will be demonstrated, the waveforms obtained at the RXp and RXn inputs to the 
      RFIC will not be exactly 180° out of phase; the result is a very slight loss in conversion gain in the 
      LNA and a small drop in overall sensitivity of the RFIC. The reduction in performance is typically less 
      than 0.5 dB; many customers may view this as an acceptable trade-off for the reduction in the bill of 
      materials (BOM).
      
      The RXp and RXn inputs of the Si446x/Si4362 RX LNA internally contain high value (~\SI{15}{k\ohm}) 
      pull-down resistors to GND. As a result, supplying a dc voltage to these pins is not recommended; use 
      of external ac-coupling to these pins is suggested. This is inherently supplied by capacitor CR2 of 
      Figure \ref{EXP001:fig_spirit07}.

      \begin{figure}[ht!]  % \ref{EXP001:fig_spirit07}
        \centering
        \includegraphics[width=1\linewidth]{spirit07_AN732.png}
        \caption{HPF Three-Element Match Network}
        \label{EXP001:fig_spirit07}
      \end{figure}
      
    \subsection{Four-Element Match Network}
      For those customers concerned with obtaining optimal performance, the 4-element match network of Figure 
      \ref{EXP001:fig_spirit08} is recommended. This match network can provide theoretically perfect phase 
      balance between the RXp and RXn inputs (exactly 180° out-of-phase), thus optimizing LNA conversion gain 
      and receiver sensitivity. The only drawback is the addition of one more component (an inductor) to the 
      BOM. Use of this matching topology is also mandatory for circuit configurations in which the TX and RX 
      paths are tied directly together without use of an RF switch. This is discussed in greater detail in 
      "4.2.8. Use of 4-Element Match Network in Direct Tie Board Configurations" on page 22.
      \begin{figure}[ht!]  % \ref{EXP001:fig_spirit08}
        \centering
        \includegraphics[width=1\linewidth]{spirit08_AN732.png}
        \caption{Four-Element Match Network}
        \label{EXP001:fig_spirit08}
      \end{figure}
    
    \subsection{Differential LNA Input Impedance} 
      Silicon Laboratories has measured the differential input impedance of the Si4461 RX LNA directly at 
      the RXp/RXn input pins of the RFIC, with no matching network. Although this measurement was taken on a 
      Si4461 chip, the data is applicable to other members of the Si446x family of chips and also on the 
      Si4362, as the LNA is similar in all devices.
      
      The plot shown in Figure \ref{EXP001:fig_spirit09} shows the measured differential input impedance in 
      the RX mode of operation over the 140 to 960 MHz frequency band, with markers placed at various points 
      throughout the frequency range.
      
      \begin{figure}[ht!]  % \ref{EXP001:fig_spirit09}
        \centering
        \includegraphics[width=1\linewidth]{spirit09_AN732.png}
        \caption{Si446x/Si4362 Differential RX LNA Input Impedance 140-960 MHz (RX Mode)}
        \label{EXP001:fig_spirit09}
      \end{figure}
       
      As can be seen from this curve, at any given single frequency the input impedance of the LNA may be 
      considered as a resistance in parallel with a small amount of capacitance. That is to say, the input 
      impedance of the LNA falls in the capacitive half of the Smith Chart across its entire operating 
      frequency range.
      
      The impedance curve shown in Figure \ref{EXP001:fig_spirit09} cannot be described by a single fixed 
      value of resistance, placed in parallel with a single fixed value of capacitance. The equivalent values 
      of  parallel resistance and capacitance (RLNA and CLNA in Figure 1 and Figure 2) vary as a function of 
      frequency. However, the variation with frequency is not rapid; it is possible to construct a moderately 
      wideband (~100 MHz) matching network by simply designing for the value of RLNA and CLNA in the center 
      of the desired frequency range.
      
      From the differential input impedance values (Z = R + jX) shown in Figure 9, it is necessary to first 
      calculate the equivalent input admittance, where Y = 1/Z = G + jB. It is then a simple matter to 
      calculate the values of the equivalent input resistor and capacitor (i.e., RLNA and CLNA in Table 1) as 
      RLNA = 1/G and CLNA = B/(2πFRF).
     
    \subsection{Three-Element Matching Procedure}
      \subsubsection{Step 1: Plot the LNA Input Impedance}
        The matching procedure begins with the equivalent parallel RLNA-CLNA circuit values obtained from 
        Table 1. At 470 MHz, the equivalent circuit values are found to be RLNA = 474 Ω and CLNA = 0.99 pF. 
        It is useful to plot this value on a Smith Chart, as shown in Figure \ref{EXP001:fig_spirit10}
        \begin{figure}[ht!]  % \ref{EXP001:fig_spirit10}
          \centering
          \includegraphics[width=1\linewidth]{spirit10_AN732.png}
          \caption{Step 1: Plot LNA Input Impedance}
          \label{EXP001:fig_spirit10}
        \end{figure}
      \subsubsection{Step 2: Add Parallel Inductance LLNA to Resonate with LNA Capacitance}
        Although Step 2 may technically be combined with the subsequent Step 3, the design equations are 
        somewhat easier to manipulate if the equivalent LNA input capacitance CLNA is first effectively 
        cancelled (at the frequency of interest) by resonating it with a parallel inductance LLNA.
        \begin{equation}\label{EXP001:eq_spirit12}
          L_{LNA} = \left(\frac{1}{\omega_0^2\cdot C_{LNA}}\right)
        \end{equation}
        
        In the design example at 470 MHz, this value of inductance is calculated to be equal to LLNA = 115.83 
        nH. After this amount of parallel inductance is added across the LNA inputs, the input impedance can 
        be considered to be purely real and of a value equivalent to RLNA. This is shown in Figure 
        \ref{EXP001:fig_spirit11}.
        
        \begin{figure}[ht!]  % \ref{EXP001:fig_spirit11}
          \centering
          \includegraphics[width=1\linewidth]{spirit11_AN732.png}
          \caption{Step 2: Add Parallel Inductance to Resonate CLNA}
          \label{EXP001:fig_spirit11}
        \end{figure}
        
      \subsubsection{Step 3: Place Additional Matching Inductance in Parallel with LNA Input}
        Next an additional matching inductor LM is placed in parallel with the LNA input network. The value 
        of the inductance should be chosen to further rotate the susceptance on the Smith Chart along a line 
        of constant conductance (in the -jBP direction) until the 50 Ω circle is reached (assuming the 
        antenna source impedance is 50 Ω). The required value of matching inductance LM is given by the 
        following:
        
        \begin{equation}\label{EXP001:eq_spirit13}
          L_M = \frac{1}{\omega_0\cdot\sqrt{\left(\dfrac{1}{\SI{50}{\ohm}\cdot R_{LNA}}\right) - 
                         \left(\dfrac{1}{R_{LNA}}\right)^2}}
        \end{equation}
        
        Using this equation, or by employing graphical methods on the Smith Chart, the additional parallel 
        matching inductance required to reach the 50 Ω circle is found to be LM = 55.12 nH.

        \begin{figure}[ht!] %\ref{EXP001:fig_spirit12}
          \centering
          \includegraphics[width=1\linewidth]{spirit12_AN732.png}
          \caption{Step 3: Add Parallel Matching Inductance LM}
          \label{EXP001:fig_spirit12}
        \end{figure}
        
        As LLNA and LM are in parallel with each other, they may be combined into one equivalent inductance 
        LR1.
        \begin{equation}\label{EXP001:eq_spirit14}
          L_{R1} = \frac{L_{LNA}\cdot L_M}{L_{LNA} + L_M}
        \end{equation}
        Using this equation, it is quickly determined that a single inductor of value LR1 = 37.35 nH may be 
        used in place of LLNA and LM.
        
      \subsubsection{Step 4: Determine Total Amount of Series Capacitive Reactance}
        It is next necessary to determine the total amount of series capacitive reactance (-jXCTOTAL) 
        required to match this point to 50 Ω. That is to say, it is desired to rotate the reactance along a 
        line of constant resistance until arriving at the center of the Smith Chart. The required value of 
        total capacitance is given by the following:
        \begin{equation}\label{EXP001:eq_spirit15}
          C_{TOTAL} = \frac{1}{\omega_0\cdot\SI{50}{\ohm}\sqrt{\dfrac{R_{LNA}}{\SI{50}{\ohm}}-1}}
        \end{equation}
        Using this equation, or by employing graphical methods on the Smith Chart, the total series 
        capacitance required to reach the 50 Ω origin of the Smith Chart is found to be CTOTAL = 2.33 pF.
        
        \begin{figure}[ht!] %\ref{EXP001:fig_spirit13}
          \centering
          \includegraphics[width=1\linewidth]{spirit13_AN732.png}
          \caption{Step 4: Determine TOTAL Series Capacitive Reactance}
          \label{EXP001:fig_spirit13}
        \end{figure}
        
      \subsubsection{Step 5: Allocate Total Series Capacitance between CR1 and CR2}
        The final step is to properly allocate this total required series capacitive reactance between CR1 
        and CR2. There are an infinite number of possible matching networks which achieve a perfect match to 
        50 Ω. However, only one of these solutions also achieves the best possible equal amplitude with 
        180°phase relationship between the waveforms at the RXp / RXn inputs.
        
        For example, it would be possible to set the value of CR1 so large that it provides essentially 0 Ω 
        of capacitive reactance and essentially ac-shorts the RXn pin to GND. Under this condition, it would 
        be possible to set the value of CR2 to provide all of the required series capacitive reactance 
        (determined in Step 4 above) and still achieve a perfect match to 50 Ω. However, it is clear that 
        the waveforms at the RXp and RXn nodes would not be balanced. The voltage at the RXn pin in this 
        scenario would be zero (ac-shorted to GND by CR1). From an ac standpoint, this is equivalent to the 
        schematic shown in Figure \ref{EXP001:fig_spirit13}
        
        To properly allocate the total series capacitive reactance between CR1 and CR2, the required 
        relationship between LR1 and CR1 must first be recognized. It is desirable for the voltages at the 
        RXp and RXn pins to be equal in amplitude but opposite in phase, and thus the voltage developed 
        “across” the parallel network of LR1-RLNA-CLNA must be twice the amplitude (and of opposite polarity) 
        as the voltage that exists at the RXn node.
        
        A portion of the parallel inductance LR1 is simply used to resonate out the capacitance CLNA. As 
        shown in Steps 2 and 3, it was useful to consider the inductance LR1 as consisting of two inductors 
        in parallel: LLNA and LM, as redrawn in Figure \ref{EXP001:fig_spirit14}.
        
        \begin{figure}[ht!] %\ref{EXP001:fig_spirit14}
          \centering
          \includegraphics[width=1\linewidth]{spirit14_AN732.png}
          \caption{Resolving LR1 into Two Parts}
          \label{EXP001:fig_spirit14}
        \end{figure}
        
        The values of these two inductances have previously been determined to be LLNA = 115.83 nH and LM = 
        55.12 nH. As the inductance LLNA is simply used to resonate with CLNA at the desired frequency of 
        operation, the match network may thus be re-drawn as shown in Figure \ref{EXP001:fig_spirit15}.

        \begin{figure}[ht!] %\ref{EXP001:fig_spirit15}
          \centering
          \includegraphics[width=1\linewidth]{spirit15_AN732.png}
          \caption{Equivalent Match Network at Operating Frequency}
          \label{EXP001:fig_spirit15}
        \end{figure}
        
        The values of these two inductances have previously been determined to be LLNA = 115.83 nH and LM = 
        55.12 nH. As the inductance LLNA is simply used to resonate with CLNA at the desired frequency of 
        operation, the match network may thus be re-drawn as shown in Figure \ref{EXP001:fig_spirit16}.

        The voltage across LM is desired to be twice the amplitude (and opposite in phase) to the voltage 
        across CR1. Temporarily ignoring the effects of R LNA , the following relationship is obtained:
        
        \begin{equation}\label{EXP001:eq_spirit16}
         X_{LM} = 2\cdot X_{CR1}
        \end{equation}
        As the required value of inductance LM has already been determined, the required value for CR1 
        follows immediately from the previously-derived equation for LM.
        \begin{equation}\label{EXP001:eq_spirit17}
          C_{R1} = 2\cdot\frac{\sqrt{\frac{R_{LNA}}{\SI{50}{\ohm}}-1}}{\omega_0\cdot R_{LNA}}
        \end{equation}
        Using this equation, the value for this capacitor is determined to be CR1 = 4.16 pF. It is then a 
        simple matter to allocate the remaining portion of total required series capacitive reactance to CR2.
        \begin{equation}\label{EXP001:eq_spirit18}
          C_{R2} = \frac{1}{\frac{1}{C_{TOTAL}-\frac{1}{C_{R1}}}}
        \end{equation}
        From this equation, the value for the remaining capacitor is quickly found to be CR2 = 5.27 pF. Thus 
        all of the components in the 3-element match network have been determined:
        \begin{itemize}
          \item CR2 = 5.27 pF
          \item LR1 = 37.35 nH
          \item CR1 = 4.16 pF
        \end{itemize}
        
      \subsubsection{Phase Imbalance of RXp/RXn Signals}
        If the input impedance of the LNA were infinite (RLNA = ∞ ), this procedure would result in 
        equal-amplitude perfectly-balanced (180° out-of-phase) waveforms at the RXp and RXn nodes. However, a 
        finite value for RLNA has the effect of shifting the phase of the signal developed across the 
        parallel combination of LR1- RLNA -CLNA; thus the voltage developed at the RXp node can never be 
        exactly 180° out-of-phase with respect to the voltage at the RXn node. This effect may be clearly 
        seen in the simulated results of Figure 10; the differential voltages are equal in amplitude but not 
        quite opposite in phase.
        \begin{figure}[ht!] %\ref{EXP001:fig_spirit17}
          \centering
          \includegraphics[width=1\linewidth]{spirit17_AN643.png}
          \caption{Differential Voltage Waveforms at LNA Input (3-Element Match)}
          \label{EXP001:fig_spirit17}
        \end{figure}
        
        As stated earlier, the 3-element match network provides slightly less-than-optimal performance when 
        compared to a perfect balun. However, the difference is usually quite small (< 0.5 dB degradation) 
        and is often acceptable. 
        
      \subsubsection{Summary Tables of 3-Element Match Network Component Values vs. Frequency}
        Some users may not be greatly interested in the theoretical development of the matching network, but 
        are concerned only with quickly obtaining a set of component values for a given desired frequency of 
        operation. For those users, the resulting calculated component values for the 3-element match network 
        for multiple frequencies across the operating range of the Si446x/Si4362 RFIC are summarized below. 
        The calculations in this table assume the ant nna source impedance is ZANT = 50 + j0Ω.
        
        The above analysis assumes use of ideal discrete components in the matching network. However, 
        surface-mount 0603- or 0402-size components themselves contain parasitic elements that modify their 
        effective values at the  frequency of interest. Additionally, the analysis presented above does not 
        make allowance for any PCB parasitics, such as trace inductance, component pad capacitance, etc. 
        Furthermore, it is convenient to use the nearest available 5\% or 10\% component value; the component 
        values shown above represent results of exact mathematical calculations.
        
        As a result, it will almost certainly be necessary to “tweak” the final matching values for a 
        specific application and board layout. The above component values should be used as starting points, 
        and the values modified slightly to zero-in on the best match to the antenna source impedance (e.g., 
        50 Ω), and the best RX sensitivity.
        
        Silicon Laboratories has empirically determined the optimum matching network values at a variety of 
        frequencies, using RF Test Boards designed by (and available from) Silicon Laboratories. Wire-wound 
        inductors (Murata LQW15A 0402-series and LQW18A 0603-series) were used in all of these matching 
        examples. Multi-layer inductors (such as Murata LQG15HS 0402-series) may also be used; however, the 
        insertion loss of the match may be increased slightly due to the higher loss of these inductors. By 
        comparing the empirical values of Table 3 with the calculated values of Table 2, the reader may 
        observe that the component values are in close agreement at frequencies below 500 MHz. However, 
        somewhat larger deviations in value occur at higher frequencies, primarily due to the unmodeled 
        parasitic effects of the PCB traces and discrete components. As mentioned previously, the calculated 
        matching component values of Table 2 should be used as a starting point and adjusted for best 
        performance.
        
        A 3-element RX match at 470 MHz was built and tested, using CR1=3.9 pF, LR1=39 nH, and CR2=5.1 pF. 
        The measured input impedance (S11) is shown in Figure 18.
        
        \begin{figure}[ht!] %\ref{EXP001:fig_spirit18}
          \centering
          \includegraphics[width=1\linewidth]{spirit18_AN643.png}
          \caption{Input Impedance of 3-Element Match at 470 MHz}
          \label{EXP001:fig_spirit18}
        \end{figure}
        
      \subsection{Four-Element Matching Procedure}
        As discussed previously, it is possible to achieve a theoretically-perfect match with the 4-element 
        match network shown in Figure 9. The complete mathematical derivation of the equations for the 
        required component values is beyond the scope of this application note; a Mathcad worksheet 
        containing the complete derivation is available from Silicon Laboratories upon request.
        
        The matching procedure for the 3-element network was readily understood and explained by plotting 
        each step on a Smith Chart. This graphical approach is somewhat less intuitive for the 4-element 
        matching procedure. Therefore, a combination of graphical and textual descriptions of the main steps 
        in the mathematical derivation is presented, along with the important equations resulting from 
        following these steps.
       
      \subsubsection{Step 1: Voltage at the RXn Node (VRXn)}
        If a network is created to successfully match to a purely-real input impedance of ZIN = 50 Ω, the 
        input current IIN will also be purely real (arbitrarily assuming an input voltage from the source 
        generator VIN of unity magnitude and zero phase). This input current passes through capacitor CR1 to 
        develop the voltage at the RXn node (VRXn). It is apparent that this voltage VRXn exhibits a –90° 
        phase shift with respect to the input current IIN, due to the capacitive reactance of CR1.
        
      \subsubsection{Step 2: Voltage at the RXp Node (VRXp)}
        The voltage at the RXp node (VRXp) is desired to be equal in amplitude to VRXn but opposite in phase. 
        For this condition to be satisfied, the voltage across the LNA input pins must be twice the amplitude 
        of VRXn, as well as exactly opposite in phase. That is to say, if the phase of VRXn is –90°, the 
        phase of VRXp must be +90°.
        
      \subsubsection{Step 3: Splitting the Input Current}
        Although the phase of the voltage across the LNA input pins must be +90°, the input impedance of the 
        LNA network is not purely inductive (unless RLNA = ∞). Thus, for the voltage across the LNA network 
        to be purely reactive, the phase of the current through the LNA network must compensate for the phase 
        shift introduced by RLNA. As a result, it is necessary that the current through the LNA network be 
        different from the current through CR1.
        
        Thus the purpose of inductor LR2 is to split the input current IIN into two different components, 
        with the current passing through the LNA network being of the appropriate phase to produce a voltage 
        of opposite phase to VRXn.
        
        \begin{align}
          L_{R2}  &= \frac{\sqrt{\Re{Z_{ANT}}\cdot R_{LNA}}}{\omega_0} 
                   = \frac{\sqrt{\SI{50}{\ohm}\cdot R_{LNA}}}{\omega_0}  \label{EXP001:eq_spirit20}      \\ 
          C_{R2}  &= \frac{1}{\omega_0^2\cdot L_{R2}}                    \label{EXP001:eq_spirit21}      \\ 
          C_{R1}  &= 2\cdot C_{R2}                                       \label{EXP001:eq_spirit22}      \\ 
          L_{LNA} &= \frac{1}{\omega_0^2\cdot C_{LNA}}                   \label{EXP001:eq_spirit23}      \\ 
          L_{M}   &= 2\cdot L_{R2}                                       \label{EXP001:eq_spirit24}      \\ 
          L_{R1}  &= \frac{L_{LNA}\cdot L_M}{L_{LNA} + L_M}              \label{EXP001:eq_spirit25} \\
        \end{align}
        Continuing the design example at 470 MHz, the component values for a 4-element match network are 
        calculated as follows:
        \begin{itemize}
          \item CR1 = 4.40 pF
          \item LR1 = 54.87 nH
          \item CR2 = 2.20 pF
          \item LR2 = 52.13 nH          
        \end{itemize}
        
      \subsubsection{Phase Balance of RXp\/RXn Signals}
        It was previously stated that an advantage of the 4-element match network was the ability to achieve 
        perfect phase balance (180 degrees) between the RXp and RXn input nodes. This effect may be clearly 
        seen in Figure 19; the differential voltages are now both equal in amplitude and perfectly opposite 
        in phase.
        
        \begin{figure}[ht!] %\ref{EXP001:fig_spirit19}
          \centering
          \includegraphics[width=1\linewidth]{spirit18_AN643.png}
          \caption{Differential Voltage Waveforms at LNA Input (4-Element Match)}
          \label{EXP001:fig_spirit19}
        \end{figure}
        
      \subsubsection{Graphical Interpretation of 4-Element Match}
        It is informative to consider a graphical interpretation of the 4-element match using a Smith Chart. 
        In practicality, it is simpler to use the design equations to obtain the required component values. 
        However, the reader may gain insight into the behavior and functionality of the match by tracing its 
        impedance progression on a Smith Chart. The investigation is simplified if the LNA input impedance is 
        temporarily considered to be purely real (i.e., CLNA = 0 pF). Although this situation does not exist 
        in practice, the input capacitance of the LNA may be easily canceled at the desired frequency of 
        operation by placing a parallel inductance LLNA across the RXp/RXn input pins, as discussed in 
        "4.1.2. Step 2: Add Parallel Inductance LLNA to Resonate with LNA Capacitance" on page 6. After 
        cancellation of the input capacitance CLNA, the “starting” point on the Smith Chart for the matching 
        procedure then becomes ZLNA = RLNA + j0 = RLNA.
        
        If considering only the input impedance (while ignoring differential signal balance), the entire 
        match circuitry may be redrawn as shown in Figure 13. While this schematic does not represent the 
        physical arrangement of components of the match, its input impedance is identical to that of the 
        actual circuit. Furthermore, representation of the match network in this “ladder” form simplifies 
        plotting the progression of the impedance match on a Smith Chart.
        
        \begin{figure}[ht!] %\ref{EXP001:fig_spirit20}
          \centering
          \includegraphics[width=1\linewidth]{spirit19_AN643.png}
          \caption{4-Element Match (re-drawn in ladder form)}
          \label{EXP001:fig_spirit20}
        \end{figure}
        
        Equation \ref{EXP001:eq_spirit20} may be manipulated as follows:
        \begin{equation}
          X_{LR2} = \omega_0\cdot L_{R2} 
                  = \sqrt{\Re{Z_{ANT}\cdot R_{LNA}}} 
                  = \sqrt{\SI{50}{\ohm}\cdot R_{LNA}}
        \end{equation}
                
  \section{Modification of Class-E Match for Direct Tie Board Configuration}
    In this section, further detail is provided about modifying the Class-E match for a Direct Tie board 
    configuration. A supply voltage of VDD = 3.3 V is assumed.
    
    \subsection{Concept of Direct Tie Matching}
      In the Direct Tie board configuration, the TX and RX paths are tied directly together at a common 
      point without the use of an RF switch. Careful design procedure must be followed to ensure that the 
      RX input circuitry does not load down the TX output path while in TX mode, and that the TX output 
      circuitry does not degrade receive performance while in RX mode.
      
      The RX input circuitry of the Si4438 chip contains a set of switches that aids in isolation of the 
      TX and RX functions. This set of switches is implemented internally as shown in Figure 
      \ref{EXP001:fig_spirit04}.
    
      \begin{figure}[ht!]  % \ref{EXP001:fig_spirit04}
        \centering
        \includegraphics[width=1\linewidth]{spirit04_AN732.png}
        \caption{RX Input Switches for Direct Tie Operation}
        \label{EXP001:fig_spirit04}
      \end{figure}
      
      These three switches are activated and closed simultaneously upon entering TX mode; the switches 
      remain open in all other modes, including RX mode. Closing these switches during TX mode 
      effectively shorts the RXp and RXn input pins together and also shorts them to GND. The effective 
      circuit may be re-drawn as shown in Figure \ref{EXP001:fig_spirit05}. Inductor LR2 and capacitor 
      CR2 have effectively been placed in parallel by the closure of the switches, and are connected to 
      GND. If the values of these components are chosen for resonance at the desired operating frequency, 
      a very high impedance is presented to the TX path resulting in very little degradation in TX output 
      power. Also, by shorting the input pins of the LNA together and simultaneously to GND, the LNA is 
      protected from the large signal swing of the TX signal. This feature allows connection of the TX 
      path to the RX path without damage to the LNA.
      \begin{figure}[ht!]  % \ref{EXP001:fig_spirit05}
        \centering
        \includegraphics[width=1\linewidth]{spirit05_AN732.png}
        \caption{Effective Class-E Direct Tie Circuit in \textbf{TX Mode}}
        \label{EXP001:fig_spirit05}
      \end{figure}
      
      In RX mode, the output transistors of the PA are in the OFF state and the impedance seen looking 
      back into the TX pin is comprised mostly of the output capacitance of the transistors. (The 
      impedance of the pull-up inductor LCHOKE is quite high and may be ignored for this discussion.) 
      This output capacitance is effectively in series with matching capacitor C0 and will result in 
      series-resonance with inductor L0 at some frequency, as shown in Figure \ref{EXP001:fig_spirit06}. 
      At this series-resonant frequency, the input to the LNA matching network is effectively shorted to 
      GND and thus significantly degrades receive performance. As the PA output capacitance CPAOFF is 
      fixed, it is necessary to choose L0 and C0 to ensure that this series-resonance does not 
      excessively degrade RX performance at the desired operating frequency. It may be necessary to alter 
      the values of L0 and/or C0 slightly away from their calculated optimum values in order to 
      accomplish this goal, thus slightly degrading TX performance in an effort to minimize the impact to 
      RX performance.
      
      \begin{figure}[ht!]  % \ref{EXP001:fig_spirit06}
        \centering
        \includegraphics[width=1\linewidth]{spirit06_AN732.png}
        \caption{Effective Class-E Direct Tie Circuit in \textbf{RX Mode}}
        \label{EXP001:fig_spirit06}
      \end{figure}

  \section{Varianta 1: 434 MHz}
    \begin{figure*}[ht!]
      \centering
      \includegraphics[width=0.8\textwidth]{modul_spirit1_sch.pdf}
      \caption{Schéma zapojení}
      \label{EXP001:fig_exp_sch434MHz}
    \end{figure*}
    
  \section{Anténa}
    \subsection{Rozdíly mezi konektory SMA a RP-SMA}
      Při výběru antény pro transceiver přijímacího systému, jsem narazil na problém s výběrem, \texttt{SMA} 
      konektoru. Jaký je tedy rozdíly mezi konektory \texttt{SMA} a \texttt{RP-SMA}? Zmatek kolem typy 
      konektorů, nejlépe vykresluje obrázek \ref{EXP001:fig_SMA_RPSMA}.
      
      \begin{figure}[ht!]
        \centering
        \includegraphics[width=0.7\linewidth]{SMA_RPSMA.jpg}
        \caption{Schéma zapojení}
        \label{EXP001:fig_SMA_RPSMA}
      \end{figure}
      
      Název těchto koaxiálních vf konektorů pochází ze zkratky \textbf{S}ub\textbf{M}iniaturní verze 
      \textbf{A} a byly vyvinuty v roce 1960. Konektor \texttt{RP-SMA} 
      je variací na specifikaci \texttt{SMA} konektoru, který obrací polaritu rozhraní, jak ostatně napovídá 
      sama zkratka: \textbf{R}everse \textbf{P}olarity \texttt{SMA}. Termín "přepólování" zde v podstatě 
      znamená změnu "pohlaví". 
      
      \begin{figure}[ht!]
        \centering  
        \begin{tabular}{cc}
          \subfloat[Female SMA]{\label{EXP001:fig_SMAf}
            \includegraphics[width=0.3\linewidth]{SMA_female.jpg}}              &
          \subfloat[Male SMA]{\label{EXP001:fig_SMAm}
            \includegraphics[width=0.3\linewidth]{SMA_male.jpg}}               \\
          \subfloat[Female RP-SMA]{\label{EXP001:fig_RPSMAf}
            \includegraphics[width=0.3\linewidth]{RPSMA_female.jpg}}            &
          \subfloat[Male RP-SMA]{\label{EXP001:fig_RPSMAm}
            \includegraphics[width=0.3\linewidth]{RPSMA_male.jpg}}             \\
        \end{tabular}
        \caption{ Samička konektoru \texttt{RP-SMA} má stejný tvar vnějšího těla jako samička \texttt{SMA}
                  konektoru, ale má vnitřní mužský pinový kontakt. Podobně sameček konektoru typu 
                  \texttt{RP-SMA} má místo vnitřního pinového kontaktu, zásuvku.}
        \label{AES:fig_EXP001:fig_SMA}
      \end{figure}   
%     Female RP-SMA connectors has a female contact body and a male inner pin contact. A male RP-SMA 
%     connector is the opposite in both respects — male body (inside threads) with a female inner sleeve 
%     contact. While Female SMA connectors has a female contact body and a female inner hole sleeve contact, 
%     and the male SMA is opposite.
      
      Důvodem zavedení \texttt{SMA} konektorů s reverzní polaritou bylo znemožnit uživateli připojovat k 
      \texttt{WIFI} zařízení běžně dostupné antény s vyšší ziskem, čímž by docházelo k porušení podmínek pro 
      jejich provoz. 
  
    
    